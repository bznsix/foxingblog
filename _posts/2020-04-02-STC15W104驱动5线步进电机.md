---
typora-root-url: ..
---

# 51单片机驱动步进电机

原来是用Arduino驱动步进电机的，但是好贵。。。所以考虑用STC15W104这个廉价的单片机来驱动。出去两个用来下载的串口之外。貌似引脚也刚刚好够用。接线如下：

A------------->P3.2

B------------->P3.3

C------------->P3.4

D------------->P3.5

中间加入了随机延时模块，因为老爸要拿来刷抖音金币？下面放下全部代码：

```c#
#include "delay.h"
#include "stc15fxxxx.h"
#include<stdlib.h>
sbit A1=P3^2; //定义步进电机连接端口
sbit SB1=P3^3;
sbit C1=P3^4;
sbit D1=P3^5;
#define Coil_A1 {A1=1;SB1=0;C1=0;D1=0;}//A相通电，其他相断电
#define Coil_B1 {A1=0;SB1=1;C1=0;D1=0;}//B相通电，其他相断电
#define Coil_C1 {A1=0;SB1=0;C1=1;D1=0;}//C相通电，其他相断电
#define Coil_D1 {A1=0;SB1=0;C1=0;D1=1;}//D相通电，其他相断电
#define Coil_OFF {A1=0;SB1=0;C1=0;D1=0;}//全部断电
unsigned char Speed = 3; //数字越小转的越快，力矩越小
unsigned int i=64*8;//转的圈数
#define MAX              10             //随机数最大值
#define MIN              50              //随机数最小值
unsigned int seed; 
unsigned int random(unsigned int xxx)
{
unsigned int value;
  srand(xxx);
  value = rand() % (MAX + 1 - MIN)+ MIN;               //获取一个随机数(1-16)
  return value;
}


void crycle()
{
 unsigned int ii;
 for(ii=0;ii<i;ii++)
 {        
	 Coil_A1                 
	 delay_ms(Speed);         
	 Coil_B1
	 delay_ms(Speed);
	 Coil_C1
	 delay_ms(Speed);
	 Coil_D1
	 delay_ms(Speed);
  }
}
void random_delay()
{
	unsigned int x =4*(random(seed));
	unsigned int xx;
	for(xx=0;xx<x;xx++)
	delay_ms(255);
	seed++;
	if(seed == 5000)
	seed = 0;
}
	
void stop(){Coil_OFF}
void main()
{	
	seed = 0;
	while(1)
	{
		crycle();
		stop();
		random_delay();
	}
}



```

